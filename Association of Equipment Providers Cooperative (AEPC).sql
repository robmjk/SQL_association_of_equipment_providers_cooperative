# Creating an inventory and order database for a business 

CREATE Database if not exists AEPC;

USE AEPC;

SHOW TABLES;

CREATE TABLE if not exists CUSTOMERS ( # Start CREATE tables
CUSTOMER_ID			BIGINT(8),
CUSTOMER_FIRST_NAME		VARCHAR(20) NOT NULL,
CUSTOMER_LAST_NAME              VARCHAR(20) NOT NULL,
CUSTOMER_EMAIL			VARCHAR(30) NOT NULL,
START_DATE			DATE, 
CUSTOMER_STREET_NUMBER		INT(255) NOT NULL,
CUSTOMER_STREET_NAME		VARCHAR(25) NOT NULL,
CUSTOMER_CITY			VARCHAR(20) NOT NULL,
CUSTOMER_STATE			VARCHAR(3) NOT NULL,
CUSTOMER_POST_CODE		INT(4),
PRIMARY KEY (CUSTOMER_ID)
)Engine=innodb;

CREATE TABLE if not exists MESSAGING (
MESSAGE_ID			BIGINT(16),
CUSTOMER_ID			BIGINT(8),
MEMBER_ID			BIGINT(7),
DATE_STAMP_FIELD		DATE,
MESSAGE_FIELD			VARCHAR(50) NOT NULL,
PRIMARY KEY (MESSAGE_ID),
FOREIGN KEY (CUSTOMER_ID) REFERENCES CUSTOMERS (CUSTOMER_ID)
)Engine=innodb;

CREATE TABLE if not exists COOP_MEMBERS (
MEMBER_ID			BIGINT(7),
MEMBER_NAME			VARCHAR(25) NOT NULL,
CONTACT_NAME			VARCHAR(25) NOT NULL,
JOIN_DATE			DATE,
RESIGNATION_DATE		DATE,
BUSINESS_NAME			VARCHAR(30) NOT NULL,
BUSINESS_STREET_NUMBER		INT(255) NOT NULL,
BUSINESS_STREET_NAME		VARCHAR(25) NOT NULL,
BUSINESS_CITY			VARCHAR(20) NOT NULL,
BUSINESS_STATE			VARCHAR(3) NOT NULL,
BUSINESS_POST_CODE 		INT(4),
MEMBER_PHONE_NUMBER		INT(10),
MEMBER_EMAIL			VARCHAR(30) NOT NULL,
MEMBER_DESCRIPTION		VARCHAR(50) NOT NULL,
PRIMARY KEY (MEMBER_ID)
)Engine=innodb;

CREATE TABLE if not exists MEMBER_EQUIPMENT (
MEMBER_ID 			BIGINT(7),
ITEM_ID 			BIGINT(15),
PRICE				DECIMAL(5),
PRICE_DATE			DATE,
IN_STOCK			VARCHAR(12),
PRIMARY KEY (MEMBER_ID, ITEM_ID),
FOREIGN KEY (MEMBER_ID) REFERENCES COOP_MEMBERS (MEMBER_ID)
)Engine=innodb;

CREATE TABLE if not exists EQUIPMENT_ITEMS (
ITEM_ID				BIGINT(15),
ITEM_NAME			VARCHAR(50) NOT NULL,
STYLE_NAME			VARCHAR(20) NOT NULL,
PACK_SIZE			VARCHAR(3) NOT NULL,
ITEM_DESCRIPTION	VARCHAR(90) NOT NULL,
UNIT_PRICE			INT(5),
UNIT_SHIPPING_COST		INT(5),
PRIMARY KEY (ITEM_ID)
)Engine=innodb;

CREATE TABLE if not exists ITEM_ORDERS (
ITEM_ID				BIGINT(15),
ORDER_ID			BIGINT(10),
ORDER_PRICE			INT(5),
ORDER_QUANTITY			INT(5),
PRIMARY KEY (ITEM_ID, ORDER_ID),
FOREIGN KEY (ITEM_ID) REFERENCES EQUIPMENT_ITEMS (ITEM_ID)
)Engine=innodb;

CREATE TABLE if not exists EQUIPMENT_ORDERS (
ORDER_ID			BIGINT(10),
ITEM_ID				BIGINT(15),
CUSTOMER_ID			BIGINT(8),
MEMBER_ID			BIGINT(7),
ORDER_DATE 			DATE,
ORDER_STATUS			VARCHAR(10) NOT NULL,
SHIPPING_DATE			DATE,
COURIER_NAME			VARCHAR(25) NOT NULL,
SHIPPING_COST_MULTIPLIER	DECIMAL(3,1), 
SHIPPING_REFERENCE_NUMBER	VARCHAR(15) NOT NULL,
PRIMARY KEY (ORDER_ID),
FOREIGN KEY (CUSTOMER_ID) REFERENCES CUSTOMERS (CUSTOMER_ID),
FOREIGN KEY (ITEM_ID) REFERENCES EQUIPMENT_ITEMS (ITEM_ID),
FOREIGN KEY (MEMBER_ID) REFERENCES COOP_MEMBERS (MEMBER_ID)
)Engine=innodb;

CREATE TABLE if not exists SHIPPING_MULTIPLIER (
MEMBER_STATE			VARCHAR(3),
CUSTOMER_STATE			VARCHAR(3),
MULTIPLIER			DECIMAL(3,1),
PRIMARY KEY (CUSTOMER_STATE, MEMBER_STATE)
)Engine=innodb; # End CREATE tables



INSERT INTO CUSTOMERS VALUES (10395831, 'John', 'Federer', 'johnfederer@gmail.com', STR_TO_DATE('19-02-20', '%d-%m-%Y'), 72, 'Verbadum Drive', 'New Farm', 'QLD', '4005'); # Start INSERT tables
INSERT INTO CUSTOMERS VALUES (83918583, 'Derrick', 'Valunhaal', 'derrickvalunhaal@gmail.com', STR_TO_DATE('28-02-20', '%d-%m-%Y'), 219, 'Solomon Street', 'Sydney', 'NSW', '2800');
INSERT INTO CUSTOMERS VALUES (28575592, 'Phil', 'Manesty', 'philmanesty@gmail.com', STR_TO_DATE('12-03-20', '%d-%m-%Y'), 49, 'Bolton Road', 'Darwin', 'NT', '0800');



INSERT INTO MESSAGING VALUES (1191208263213644, 10395831, 1026127, STR_TO_DATE('05-03-20', '%d-%m-%Y'), 'Enter message here');
INSERT INTO MESSAGING VALUES (3583080583463637, 83918583, 1467100, STR_TO_DATE('13-03-20', '%d-%m-%Y'), 'Enter message here');
INSERT INTO MESSAGING VALUES (2994668202200164, 28575592, 1453010, STR_TO_DATE('03-04-20', '%d-%m-%Y'), 'Enter message here');



INSERT INTO COOP_MEMBERS VALUES (1026127, 'June Crocker', 'June', STR_TO_DATE('04-08-16', '%d-%m-%Y'), NULL, 'Fabulous Furniture', 58, 'Top Street', 'Neutral Bay', 'NSW', '2089', 0450729846, 'junecrocker@gmail.com', 'Description...');                     
INSERT INTO COOP_MEMBERS VALUES (2157550, 'Amelia Zinski', 'Amelia', STR_TO_DATE('02-10-16', '%d-%m-%Y'), NULL, 'Fine Favours', 37, 'Green Road', 'Broome', 'WA', '6385', 0433027946, 'ameliazinski@gmail.com', 'Description...');
INSERT INTO COOP_MEMBERS VALUES (1467100, 'Toby Roberts', 'Toby', STR_TO_DATE('21-02-17', '%d-%m-%Y'), NULL, 'Party On', 187, 'Queens Road', 'Melbourne', 'VIC', '3650', 0476766314, 'tobyroberts@gmail.com', 'Description...');
INSERT INTO COOP_MEMBERS VALUES (1825016, 'Geraldine Frobisher', 'Geraldine', STR_TO_DATE('16-03-17', '%d-%m-%Y'), NULL, 'Plentiful Plates and Crockery', 423, 'Wallsend Road', 'Tanunda', 'SA', '5412', 0426712008, 'geraldinefrobisher@gmail.com', 'Description...');
INSERT INTO COOP_MEMBERS VALUES (1453010, 'Adam Cost', 'Adam', STR_TO_DATE('09-07-17', '%d-%m-%Y'), NULL, 'Shade Creators', 20, 'First Street', 'Canberra', 'ACT', '2116', 0407057569, 'adamcost@gmail.com', 'Description...');
INSERT INTO COOP_MEMBERS VALUES (2595016, 'Bill Adamson', 'Bill', STR_TO_DATE('19-01-18', '%d-%m-%Y'), NULL, 'Exotic Soft Furnishings', 28, 'Baseline Street', 'Darwin', 'NT', '0810', 0433157358, 'billadamson@gmail.com', 'Description...');



INSERT INTO MEMBER_EQUIPMENT VALUES (1026127, 852957106864937, 30, STR_TO_DATE('12-10-16', '%d-%m-%Y'), 'IN STOCK');
INSERT INTO MEMBER_EQUIPMENT VALUES (1467100, 913996403385485, 25, STR_TO_DATE('08-12-16', '%d-%m-%Y'), 'IN STOCK');
INSERT INTO MEMBER_EQUIPMENT VALUES (1453010, 209586647184420, 25, STR_TO_DATE('29-11-16', '%d-%m-%Y'), 'IN STOCK');
INSERT INTO MEMBER_EQUIPMENT VALUES (2157550, 019978361847392, 15, STR_TO_DATE('23-09-16', '%d-%m-%Y'), 'IN STOCK');
INSERT INTO MEMBER_EQUIPMENT VALUES (1825016, 928348754838129, 15, STR_TO_DATE('16-10-16', '%d-%m-%Y'), 'IN STOCK');
INSERT INTO MEMBER_EQUIPMENT VALUES (2595016, 597435734831896, 10, STR_TO_DATE('02-01-17', '%d-%m-%Y'), 'IN STOCK');
INSERT INTO MEMBER_EQUIPMENT VALUES (1026127, 584846752912751, 10, STR_TO_DATE('05-01-17', '%d-%m-%Y'), 'OUT OF STOCK');
INSERT INTO MEMBER_EQUIPMENT VALUES (1467100, 685493634523742, 15, STR_TO_DATE('29-12-16', '%d-%m-%Y'), 'IN STOCK');
INSERT INTO MEMBER_EQUIPMENT VALUES (1453010, 127758534881683, 60, STR_TO_DATE('27-12-16', '%d-%m-%Y'), 'OUT OF STOCK');
INSERT INTO MEMBER_EQUIPMENT VALUES (2157550, 392886820802348, 3995, STR_TO_DATE('07-01-17', '%d-%m-%Y'), 'IN STOCK');
INSERT INTO MEMBER_EQUIPMENT VALUES (1825016, 940909238175763, 50, STR_TO_DATE('04-01-17', '%d-%m-%Y'), 'IN STOCK');



INSERT INTO EQUIPMENT_ITEMS VALUES (852957106864937, '10 pack dinner plates', 'Elegant', 10, '25 cm plate white with gold rim', 30, 15);
INSERT INTO EQUIPMENT_ITEMS VALUES (913996403385485, '10 pack side plate', 'Elegant', 10, '15cm plate white with gold rim', 25, 15);
INSERT INTO EQUIPMENT_ITEMS VALUES (209586647184420, '10 setting dinner cutlery pack', 'Fiddle', 10, 'Silver plated dinner knife and fork and side plate knife', 25, 5);
INSERT INTO EQUIPMENT_ITEMS VALUES (019978361847392, '10 setting desert cutlery pack', 'Fiddle', 10, 'Silver plated dessert spoon and fork set', 15, 5);
INSERT INTO EQUIPMENT_ITEMS VALUES (928348754838129, '10 pack champagne flutes', 'Ovation', 10, 'Champagne flute', 15, 10);
INSERT INTO EQUIPMENT_ITEMS VALUES (597435734831896, '10 pack wine glasses', 'Ovation', 10, '10oz wine glass', 10, 10);
INSERT INTO EQUIPMENT_ITEMS VALUES (584846752912751, '10 pack tumblers', 'Ovation', 10, '12oz tumbler', 10, 10);
INSERT INTO EQUIPMENT_ITEMS VALUES (685493634523742, 'Chivari Chair', 'White', 1, 'Stackable dining chair', 15, 5);
INSERT INTO EQUIPMENT_ITEMS VALUES (127758534881683, 'Naked Table', 'White', 1, '200cm x 68cm trestle table', 60, 20);
INSERT INTO EQUIPMENT_ITEMS VALUES (392886820802348, '10m x10m Marquee', 'View', 1, 'Clear-sided marquee', 3995, 500);
INSERT INTO EQUIPMENT_ITEMS VALUES (940909238175763, '10 pack, party favours', 'Waratah', 10, 'Personalised hand fan', 50, 10);



INSERT INTO ITEM_ORDERS VALUES (597435734831896, 1937529475, 10, 1);
INSERT INTO ITEM_ORDERS VALUES (913996403385485, 4829485052, 25, 2);
INSERT INTO ITEM_ORDERS VALUES (209586647184420, 5703425703, 25, 4);



INSERT INTO EQUIPMENT_ORDERS VALUES (1937529475, 597435734831896, 10395831, 2595016, STR_TO_DATE('06-03-20', '%d-%m-%Y'), 'ORDERED', STR_TO_DATE('10-03-20', '%d-%m-%Y'), 'Rodger Ballard', 1.4, 420175385918350);
INSERT INTO EQUIPMENT_ORDERS VALUES (4829485052, 913996403385485, 83918583, 1467100, STR_TO_DATE('14-03-20', '%d-%m-%Y'), 'ORDERED', STR_TO_DATE('17-03-20', '%d-%m-%Y'), 'Anthony Kohart', 1.2, 195729385590212); 
INSERT INTO EQUIPMENT_ORDERS VALUES (5703425703, 209586647184420, 28575592, 1453010, STR_TO_DATE('02-04-20', '%d-%m-%Y'), 'ORDERED', STR_TO_DATE('02-09-20', '%d-%m-%Y'), 'Steven Mallik', 1.9, 528375018485784); 



INSERT INTO SHIPPING_MULTIPLIER VALUES ('NSW', 'NSW', 1);
INSERT INTO SHIPPING_MULTIPLIER VALUES ('NSW', 'QLD', 1.5);
INSERT INTO SHIPPING_MULTIPLIER VALUES ('NSW', 'NT', 1.9);
INSERT INTO SHIPPING_MULTIPLIER VALUES ('NSW', 'VIC', 1.2);
INSERT INTO SHIPPING_MULTIPLIER VALUES ('NSW', 'SA', 1.4);
INSERT INTO SHIPPING_MULTIPLIER VALUES ('NSW', 'ACT', 1);
INSERT INTO SHIPPING_MULTIPLIER VALUES ('NSW', 'WA', 2.4);
INSERT INTO SHIPPING_MULTIPLIER VALUES ('NSW', 'TAS', 2);
INSERT INTO SHIPPING_MULTIPLIER VALUES ('QLD', 'QLD', 1);
INSERT INTO SHIPPING_MULTIPLIER VALUES ('QLD', 'NT', 1.4);
INSERT INTO SHIPPING_MULTIPLIER VALUES ('QLD', 'VIC', 1.9);
INSERT INTO SHIPPING_MULTIPLIER VALUES ('QLD', 'SA', 1.8);
INSERT INTO SHIPPING_MULTIPLIER VALUES ('QLD', 'ACT', 1.5);
INSERT INTO SHIPPING_MULTIPLIER VALUES ('QLD', 'WA', 2.5);
INSERT INTO SHIPPING_MULTIPLIER VALUES ('QLD', 'TAS', 2.1);
INSERT INTO SHIPPING_MULTIPLIER VALUES ('NT', 'NT', 1);
INSERT INTO SHIPPING_MULTIPLIER VALUES ('NT', 'VIC', 2.2);
INSERT INTO SHIPPING_MULTIPLIER VALUES ('NT', 'SA', 1.2);
INSERT INTO SHIPPING_MULTIPLIER VALUES ('NT', 'ACT', 1.9);
INSERT INTO SHIPPING_MULTIPLIER VALUES ('NT', 'WA', 1.5);
INSERT INTO SHIPPING_MULTIPLIER VALUES ('NT', 'TAS', 2.5);
INSERT INTO SHIPPING_MULTIPLIER VALUES ('VIC', 'VIC', 1);
INSERT INTO SHIPPING_MULTIPLIER VALUES ('VIC', 'SA', 1.2);
INSERT INTO SHIPPING_MULTIPLIER VALUES ('VIC', 'ACT', 1.3);
INSERT INTO SHIPPING_MULTIPLIER VALUES ('VIC', 'WA', 2.2);
INSERT INTO SHIPPING_MULTIPLIER VALUES ('VIC', 'TAS', 1.3);
INSERT INTO SHIPPING_MULTIPLIER VALUES ('SA', 'SA', 1);
INSERT INTO SHIPPING_MULTIPLIER VALUES ('SA', 'ACT', 1.5);
INSERT INTO SHIPPING_MULTIPLIER VALUES ('SA', 'WA', 1.6);
INSERT INTO SHIPPING_MULTIPLIER VALUES ('SA', 'TAS', 2.1);
INSERT INTO SHIPPING_MULTIPLIER VALUES ('ACT', 'ACT', 1);
INSERT INTO SHIPPING_MULTIPLIER VALUES ('ACT', 'WA', 2.6);
INSERT INTO SHIPPING_MULTIPLIER VALUES ('ACT', 'TAS', 1.7);
INSERT INTO SHIPPING_MULTIPLIER VALUES ('WA', 'WA', 1);
INSERT INTO SHIPPING_MULTIPLIER VALUES ('WA', 'TAS', 2.4);
INSERT INTO SHIPPING_MULTIPLIER VALUES ('TAS', 'TAS', 1); # End INSERT tables

ALTER TABLE MESSAGING # Start ALTER tables
ADD CONSTRAINT FK_MesMem_MEMBER_ID
FOREIGN KEY (MEMBER_ID) REFERENCES COOP_MEMBERS (MEMBER_ID); 


ALTER TABLE MEMBER_EQUIPMENT
ADD CONSTRAINT FK_IteEqp_ITEM_EQUIPMENT
FOREIGN KEY (ITEM_ID) REFERENCES EQUIPMENT_ITEMS (ITEM_ID);


ALTER TABLE ITEM_ORDERS
ADD CONSTRAINT FK_IteOrd_ITEM_0RDERS
FOREIGN KEY (ORDER_ID) REFERENCES EQUIPMENT_ORDERS (ORDER_ID); # End ALTER tables


USE aepc; # Start TRIGGER

DROP TRIGGER IF EXISTS order_message;

DELIMITER $$
$$
CREATE TRIGGER order_message
AFTER INSERT
ON equipment_orders FOR EACH ROW
INSERT INTO messaging (
  MESSAGE_ID,
  CUSTOMER_ID,
  MEMBER_ID,
  DATE_STAMP_FIELD,
  MESSAGE_FIELD)
VALUES (
  'New Order',
  NEW.CUSTOMER_ID,
  NEW.MEMBER_ID,
  NOW(),
 'Order placed');
$$
DELIMITER ; # End TRIGGER



DROP FUNCTION IF EXISTS calc_item_costs; # Start FUNCTION

DELIMITER $$
$$
CREATE FUNCTION calc_item_costs(
  ord_id char(10),
  itm_id char(15))
RETURNS REAL
READS SQL DATA
BEGIN
  DECLARE item_cost REAL;

  SELECT (io.order_quantity * ei.unit_price) + 
         (eo.shipping_cost_multiplier * io.order_quantity * ei.unit_shipping_cost)
    INTO item_cost
    FROM item_orders io
         INNER JOIN equipment_items ei ON ei.item_id = io.item_id
         INNER JOIN equipment_orders eo ON eo.order_id = io.order_id
   WHERE io.order_id = ord_id
     AND io.item_id = itm_id;

  RETURN item_cost;
END$$
DELIMITER ; # End FUNCTION


SELECT CUSTOMER_FIRST_NAME, CUSTOMER_ID FROM CUSTOMERS WHERE CUSTOMER_ID = 10395831 # This code produces the customer name and customer ID (account number)


DELIMITER $$
SET @p0='1937529475'; SET @p1='597435734831896'; SELECT `calc_item_costs`(@p0, @p1) AS `calc_item_costs`; # This code calculates the total amount of a singular order. It can also be used at the function section on phpmyadmin from program Xampp
DELIMITER ;

DELIMITER $$
SELECT ORDER_DATE FROM EQUIPMENT_ORDERS WHERE ORDER_ID = 1937529475 # Displays order date for a singular order that has been made
DELIMITER ;



# To drop database use: DROP DATABASE if exists AEPC;